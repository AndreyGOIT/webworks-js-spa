<!DOCTYPE html>
<html lang="fi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebWorks Studio</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <header class="py-3" >
      <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light m-0" >
          <button
            class="navbar-brand btn btn-link p-0"
            onclick="loadPage('home')"
          >
            <img
              src="./images/Logo_WebWorks_Studio.png"
              alt="Logo"
              height="40"
            />
            WebWorks Studio
          </button>
          <!-- nav btns -->
          <button
            class="navbar-toggler toggler-btn"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
          >
            <span class="navbar-toggler-icon toggler-btn"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('home')">HOME</button>
              </li>
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('tuotteet')">TUOTTEET</button>
              </li>
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('yhteystiedot')">YHTEYSTIEDOT</button>
              </li>
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('henkilokunta')">HENKILÖKUNTA</button>
              </li>
              <!--login and logout buttons-->
              <li class="nav-item">
                <button
                  id="login-button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#loginModal"
                >
                  Login
                </button>
              </li>
              <li class="nav-item">
                <button
                  id="logout-button"
                  class="btn btn-danger d-none"
                  onclick="logout()"
                >
                  Logout
                </button>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!-- main osio -->
    <main class="container my-5" >
      <div id="main_alue">Tervetuloa WebWorks Studioon!</div>
    </main>

    <footer id="footer-main" class="container-fluid  text-white py-4">
      <div class="container">
        <div class="footer-row">
          <!-- Koodilohko yhteystiedoilla -->
          <div class="footer-row-item">
            <h3>Yhteystiedot:</h3>
            <address class="footer-nav-address">
              <p class="nav-text">WebWorks Studio Oy</p>
              <p class="nav-text">Osoite: Hevosenkengänkatu 2, 06100, Porvoo</p>
              <p class="nav-text">
                Email:
                <a href="mailto:info@webworksstudio.com" rel="noopener noreferrer"
                  >info@webworksstudio.com</a
                >
              </p>
              <p class="nav-text">
                Puhelin:
                <a href="tel:+358XXXXXXXXX" rel="noopener noreferrer"
                  >+358 (XX) XXX-XXXX</a
                >
              </p>
            </address>
          </div>
          <!-- Koodilohko, jossa on navigointi -->
          <div class="footer-row-item">
            <h3>Navigointi</h3>
            <nav>
              <ul class="footer-nav-list">
                <li><button class="footer-nav-button" onclick="loadPage('home')">Home</button></li>
                <li><button class="footer-nav-button" onclick="loadPage('tuotteet')">Tuotteet</button></li>
                <li><button class="footer-nav-button" onclick="loadPage('yhteystiedot')">Yhteystiedot</button></li>
              </ul>
            </nav>
          </div>
          <!-- Koodilohko sosiaalisten verkostojen kanssa -->
          <div class="footer-row-item">
            <h3>Seuraa meitä</h3>
            <div class="footer-row some d-flex gap-2"> 
              <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" 
                 aria-label="Facebook" title="Facebook"
                 class="btn btn-primary">
                <i class="fab fa-facebook"></i>
              </a>
          
              <a href="https://twitter.com" target="_blank" rel="noopener noreferrer"
                 aria-label="Twitter" title="Twitter"
                 class="btn btn-info">
                <i class="fab fa-twitter"></i>
              </a>
          
              <a href="https://instagram.com" target="_blank" rel="noopener noreferrer"
                 aria-label="Instagram" title="Instagram"
                 class="btn btn-danger">
                <i class="fab fa-instagram"></i>
              </a>
          
              <a href="https://linkedin.com" target="_blank" rel="noopener noreferrer"
                 aria-label="Linkedin" title="Linkedin"
                 class="btn btn-primary">
                <i class="fab fa-linkedin"></i>
              </a>
            </div>
          </div>
        </div>
        <hr />
        <div class="footer-bottom">
          <p class="m-0">
            <img
              src="images/Logo_WebWorks_Studio.png"
              alt="Firman Logo"
              width="50"
              class="logo-bottom"
            />
              Created in WebWorks Studio by Andy E. &copy; 2025
          </p>
        </div>
      </div>
      </footer>

    <!-- Modaalinen kirjautumisikkuna -->
    <div
      class="modal fade"
      id="loginModal"
      tabindex="-1"
      aria-labelledby="loginModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">Kirjaudu sisään</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <label for="username">Käyttäjänimi:</label>
            <input type="text" id="username" class="form-control" />

            <label for="password" class="mt-2">Salasana:</label>
            <input type="password" id="password" class="form-control" />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Sulje
            </button>
            <button type="button" class="btn btn-primary" onclick="login()">
              Kirjaudu
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="./js/app.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", checkAuthStatus);

      function login() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
          credentials: "include", // TÄRKEÄÄ: Evästeiden lähettäminen istunnon mukana
        })
          .then((response) => {
            console.log("ответ response при логине: ", response);
            if (response.ok) {
              checkAuthStatus(); // Tarkista tila heti sisäänkirjautumisen jälkeen
              bootstrap.Modal.getInstance(
                document.getElementById("loginModal")
              ).hide();
            } else {
              alert("Väärä käyttäjätunnus tai salasana");
            }
          })
          .catch((error) => console.error('Virhe:", error'));
      }

      function logout() {
        fetch("/api/logout", {
          method: "POST",
          credentials: "include", // Istunnon poistaminen palvelimelta
        })
          .then(() => checkAuthStatus())
          .catch((error) => console.error('Virhe:", error'));
      }

      function checkAuthStatus() {
        fetch("/api/check-auth", {
          method: "GET",
          credentials: "include", // Tarkistetaan istuntoa palvelimella
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Server response:", data);
            console.log("data.isAuthenticated: ", data.isAuthenticated);
            updateAuthUI(data.isAuthenticated);
          })
          .catch(() => updateAuthUI(false));
      }

      function updateAuthUI(isLoggedIn) {
        let loginBtn = document.getElementById("login-button");
        let logoutBtn = document.getElementById("logout-button");

        if (!logoutBtn) {
          console.error("Logout button не найден в DOM!");
          return;
        }

        if (isLoggedIn) {
          loginBtn.classList.add("d-none");
          logoutBtn.classList.remove("d-none"); // Show Logout
        } else {
          loginBtn.classList.remove("d-none");
          logoutBtn.classList.add("d-none"); // Hiding Logout
        }
      }
    </script>
  </body>
</html>
