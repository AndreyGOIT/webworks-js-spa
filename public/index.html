<!DOCTYPE html>
<html lang="fi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebWorks Studio</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <header class="py-2" >
      <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light m-0" >
          <button
            class="navbar-brand btn btn-link p-0"
            onclick="loadPage('home')"
          >
            <img
              src="./images/Logo_WebWorks_Studio.png"
              alt="Logo"
              height="50"
            />
            <div class="brand-text">
              WebWorks Studio
              <span id="auth-username"></span>
            </div>
          </button>
          <!-- nav btns -->
          <button
            class="navbar-toggler toggler-btn"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
          >
            <span class="navbar-toggler-icon toggler-btn"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('home')">HOME</button>
              </li>
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('tuotteet')">TUOTTEET</button>
              </li>
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('yhteystiedot')">YHTEYSTIEDOT</button>
              </li>
              <li class="nav-item">
                <button class="nav-btn" onclick="loadPage('henkilosto')">HENKIL√ñST√ñ</button>
              </li>
              <!--login and logout buttons-->
              <li class="nav-item">
                <button
                  id="login-button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#loginModal"
                >
                  Login
                </button>
              </li>
              <li class="nav-item">
                <button
                  id="logout-button"
                  class="btn btn-danger d-none"
                  onclick="logout()"
                >
                  Logout
                </button>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!-- main osio -->
    <main class="container my-5" >
      <div id="main_alue">Tervetuloa WebWorks Studioon!</div>
      <!------------------------CHAT--------------------------->
      <div class="hidden">
        <!-- Floating button  -->
        <div div id="chat-button">üí¨</div>

        <!-- Modal name window -->
        <div id="customPrompt" class="modal">
          <div class="modal-content">
            <h2 class="modal-title">Enter your name for chat</h2>
            <input type="text" id="promptInput" placeholder="your name">
            <div class="prompt-buttons">
            <button class="promtpBtn" onclick="resolvePrompt()">OK</button>
            <button class="promtpBtn" onclick="rejectPrompt()">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Modal chat window -->
        <div id="chat-modal">
          <div id="chat-header">
            <h5 id="chat-title">SUPPORT CHAT</h5>
            <button id="close-chat">&times;</button>
          </div>
          <div id="chat-content"></div>
          <div id="chat-input-container">
            <input
              type="text"
              id="chat-input"
              placeholder="Write a message..."
            />
            <button id="send-message">Send</button>
          </div>
        </div>
      </div>
      <!----------------------- end CHAT --------------------------->
    </main>

    <footer id="footer-main" class="container-fluid  text-white py-4">
      <div class="container">
        <div class="footer-row">
          <!-- Koodilohko yhteystiedoilla -->
          <div class="footer-row-item">
            <h3>Yhteystiedot:</h3>
            <address class="footer-nav-address">
              <p class="nav-text">WebWorks Studio Oy</p>
              <p class="nav-text">Osoite: Hevosenkeng√§nkatu 2, 06100, Porvoo</p>
              <p class="nav-text">
                Email:
                <a href="mailto:info@webworksstudio.com" rel="noopener noreferrer"
                  >info@webworksstudio.com</a
                >
              </p>
              <p class="nav-text">
                Puhelin:
                <a href="tel:+358XXXXXXXXX" rel="noopener noreferrer"
                  >+358 (XX) XXX-XXXX</a
                >
              </p>
            </address>
          </div>
          <!-- Koodilohko, jossa on navigointi -->
          <div class="footer-row-item">
            <h3>Navigointi</h3>
            <nav>
              <ul class="footer-nav-list">
                <li><button class="footer-nav-button" onclick="loadPage('home')">HOME</button></li>
                <li><button class="footer-nav-button" onclick="loadPage('tuotteet')">TUOTTEET</button></li>
                <li><button class="footer-nav-button" onclick="loadPage('yhteystiedot')">YHTEYSTIEDOT</button></li>
                <li><button class="footer-nav-button" onclick="loadPage('henkilosto')">HENKIL√ñST√ñ</button></li>
              </ul>
            </nav>
          </div>
          <!-- Koodilohko sosiaalisten verkostojen kanssa -->
          <div class="footer-row-item">
            <h3>Seuraa meit√§</h3>
            <div class="footer-row some d-flex gap-2"> 
              <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" 
                 aria-label="Facebook" title="Facebook"
                 class="btn btn-primary">
                <i class="fab fa-facebook"></i>
              </a>
          
              <a href="https://twitter.com" target="_blank" rel="noopener noreferrer"
                 aria-label="Twitter" title="Twitter"
                 class="btn btn-info">
                <i class="fab fa-twitter"></i>
              </a>
          
              <a href="https://instagram.com" target="_blank" rel="noopener noreferrer"
                 aria-label="Instagram" title="Instagram"
                 class="btn btn-danger">
                <i class="fab fa-instagram"></i>
              </a>
          
              <a href="https://linkedin.com" target="_blank" rel="noopener noreferrer"
                 aria-label="Linkedin" title="Linkedin"
                 class="btn btn-primary">
                <i class="fab fa-linkedin"></i>
              </a>
            </div>
          </div>
        </div>
        <hr />
        <div class="footer-bottom">
          <p class="m-0">
            <img
              src="images/Logo_WebWorks_Studio.png"
              alt="Firman Logo"
              width="50"
              class="logo-bottom"
            />
              Created in WebWorks Studio by Andy E. &copy; 2025
          </p>
        </div>
      </div>
      </footer>

    <!--------- Modaalinen kirjautumisikkuna ------->
    <div
      class="modal fade"
      id="loginModal"
      tabindex="-1"
      aria-labelledby="loginModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">Kirjaudu sis√§√§n</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <label for="username">K√§ytt√§j√§nimi:</label>
            <input type="text" id="username" class="form-control" />

            <label for="password" class="mt-2">Salasana:</label>
            <input type="password" id="password" class="form-control" />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Sulje
            </button>
            <button type="button" class="btn btn-primary" onclick="login()">
              Kirjaudu
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-------- end Modaalinen kirjautumisikkuna ---->

    <script src="js/registration.js" defer></script>
    <script src="js/app.js" defer></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="js/socket.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", checkAuthStatus);

      function login() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
          credentials: "include", // T√ÑRKE√Ñ√Ñ: Ev√§steiden l√§hett√§minen istunnon mukana
        })
          .then((response) => {
            // console.log("response response when logging in: ", response);
            if (response.ok) {
              checkAuthStatus(); // Tarkista tila heti sis√§√§nkirjautumisen j√§lkeen
              bootstrap.Modal.getInstance(
                document.getElementById("loginModal")
              ).hide();
            } else {
              alert("V√§√§r√§ k√§ytt√§j√§tunnus tai salasana");
            }
          })
          .catch((error) => console.error('Virhe:", error'));
      }

      function logout() {
        fetch("/api/logout", {
          method: "POST",
          credentials: "include", // Istunnon poistaminen palvelimelta
        })
          .then(response => {
              if (!response.ok) {
                  throw new Error("Exit error: " + response.statusText);
              }
              return response.json();
            })
          .then(data => {
              // console.log("The exit is complete:", data.message);
              checkAuthStatus(); // K√§ytt√∂liittym√§n p√§ivitt√§minen (painikkeiden piilottaminen/n√§ytt√§minen)
              loadPage('home');
          })
          .catch((error) => console.error('Virhe:", error'));
      }

      function checkAuthStatus() {
        fetch("/api/check-auth", {
          method: "GET",
          credentials: "include", // Tarkistetaan istuntoa palvelimella
        })
          .then((response) => response.json())
          .then((data) => {
            // console.log("Server response:", data);
            // console.log("data.isAuthenticated: ", data.isAuthenticated);
            updateAuthUI(data.isAuthenticated, data.user.name);
          })
          .catch(() => updateAuthUI(false));
      }

      function updateAuthUI(isLoggedIn, username) {
        let loginBtn = document.getElementById("login-button");
        let logoutBtn = document.getElementById("logout-button");

        if (!logoutBtn) {
          console.error("Logout button not found in DOM!");
          return;
        }

        if (isLoggedIn) {
          loginBtn.classList.add("d-none");
          logoutBtn.classList.remove("d-none"); // Show Logout btn
          
          document.getElementById("auth-username").textContent = username; // Show username in navbar
        } else {
          loginBtn.classList.remove("d-none");
          logoutBtn.classList.add("d-none"); // Hiding Logout btn
          document.getElementById("auth-username").textContent = ""; // Hide username in navbar
        }
      }
    </script>
  </body>
</html>
